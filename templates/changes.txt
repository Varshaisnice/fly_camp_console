<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlyCamp Console</title>
  <link rel="stylesheet" href="console.css" />
</head>
<body>

  <!-- BLACK SCREEN OVERLAY -->
  <div id="black-overlay" class="black-overlay"></div>

  <!-- Page 1: Welcome / RFID Scan -->
  <div class="screen active" id="page1">
    <div class="content-box">
      <h1>Welcome to FlyCamp</h1>
      <p id="loader1" class="muted">Waiting for token...</p>
      <button class="btn-ghost" onclick="backToHome()">Back</button>
    </div>
  </div>

  <!-- Page 2: Confirm Player -->
  <div class="screen" id="page2">
    <div class="content-box">
      <h2 id="greeting">Hi!</h2>
      <p id="user-info">Token number: </p>
      <div class="btn-row">
        <button class="btn-cta" onclick="confirmPlayer()">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Page: Choose Game -->
  <div class="screen" id="page_choose_game">
    <div class="content-box">
      <div id="game-card-container" class="card-slider">

        <!-- GAME 1 – Mine Seeker -->
        <article class="card"
          data-game-id="1"
          data-title="Mine Seeker"
          data-desc="#rules-mine-seeker">
          <h2 class="card-title">Mine Seeker</h2>
          <div class="point-cards">
            <div class="point-card"><span class="point-bullet"></span><p>An <strong>angel drone</strong> must disarm glowing mines to protect the battlefield.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>One mine <strong>activates and glows red</strong> at a time.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Fly over it to <strong>disarm</strong> and score.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>New mine activates after each disarm.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Disarm as many as possible before <strong>time runs out</strong>!</p></div>
          </div>
          <div class="card-media">
            <img class="card-image" src="static/assets/hover_and_seek.png" alt="Mine Seeker Drone"/>
          </div>
        </article>

        <!-- GAME 2 – Candy Commander -->
        <article class="card"
          data-game-id="2"
          data-title="Candy Commander"
          data-desc="#rules-candy-commander">
          <h2 class="card-title">Candy Commander</h2>
          <div class="point-cards">
            <div class="point-card"><span class="point-bullet"></span><p>A <strong>hungry Candy Boss</strong> demands sweets — obey its color!</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>It <strong>flashes a color cue</strong> showing what it wants.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Fly to the <strong>matching candy station</strong> to deliver.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p><strong>Fast deliveries</strong> = higher score!</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Feed it before <strong>time ends</strong>.</p></div>
          </div>
          <div class="card-media">
            <img class="card-image" src="static/assets/hues_the_boss.png" alt="Candy Commander Drone"/>
          </div>
        </article>

        <!-- GAME 3 – Code Breaker -->
        <article class="card"
          data-game-id="3"
          data-title="Code Breaker"
          data-desc="#rules-code-breaker">
          <h2 class="card-title">Code Breaker</h2>
          <div class="point-cards">
            <div class="point-card"><span class="point-bullet"></span><p>An <strong>evil AI</strong> corrupts the data center — decode colors to secure ports.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Each round shows <strong>glitched color cues</strong>.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Decode if clue is <strong>text, font color, or background</strong>.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Fly to the <strong>correct data port</strong> to secure it.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p><strong>Wrong move = score loss</strong> — think fast!</p></div>
          </div>
          <div class="card-media">
            <img class="card-image" src="static/assets/color_chaos.png" alt="Code Breaker Drone"/>
          </div>
        </article>

      </div>
    </div>
  </div>

  <!-- Page: Confirm Game (NO VIDEO) -->
  <div class="screen" id="page_confirm">
    <div class="content-box">
      <h2 id="chosen-game-title">You chose:</h2>
      <p id="chosen-game-desc"></p>

      <!-- Dynamic Rules from Game Card -->
      <div id="rules-container" class="game-rules">
        <div id="rules-mine-seeker" class="rule-set hidden">
          <h3 class="rules-title">Mine Seeker Rules</h3>
          <div class="point-cards">
            <div class="point-card"><span class="point-bullet"></span><p>An <strong>angel drone</strong> must disarm glowing mines.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>One mine <strong>glows red</strong> at a time.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Fly over it to <strong>disarm</strong> and score.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>New mine activates after each disarm.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Disarm as many as possible before <strong>time runs out</strong>!</p></div>
          </div>
        </div>
        <div id="rules-candy-commander" class="rule-set hidden">
          <h3 class="rules-title">Candy Commander Rules</h3>
          <div class="point-cards">
            <div class="point-card"><span class="point-bullet"></span><p>A <strong>hungry Candy Boss</strong> demands sweets.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>It <strong>flashes a color</strong> — deliver matching candy.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Fly to the <strong>matching station</strong>.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p><strong>Speed = Score</strong>.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Feed it before <strong>time ends</strong>.</p></div>
          </div>
        </div>
        <div id="rules-code-breaker" class="rule-set hidden">
          <h3 class="rules-title">Code Breaker Rules</h3>
          <div class="point-cards">
            <div class="point-card"><span class="point-bullet"></span><p><strong>Evil AI</strong> corrupts data — decode colors.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Each round shows <strong>glitched cues</strong>.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Decode: <strong>text, font, or background</strong>?</p></div>
            <div class="point-card"><span class="point-bullet"></span><p>Fly to the <strong>correct port</strong>.</p></div>
            <div class="point-card"><span class="point-bullet"></span><p><strong>Wrong = penalty</strong>. Think fast!</p></div>
          </div>
        </div>
      </div>

      <div class="btn-row big mt-8">
        <button class="btn-cta" id="confirm-game-btn">Start Game</button>
        <button class="btn-ghost" onclick="backToChoose()">Back</button>
      </div>
    </div>
  </div>

  <!-- Page 5: Initialisation -->
  <div class="screen" id="page_initializing">
    <div class="content-box init-wrap">
      <div class="generic-rules">
        <h3 class="rules-title">Generic Flying Instructions</h3>
        <p class="muted" style="margin-bottom:16px;">After reading the rules, click "Start Game."</p>
        <div class="point-cards">
          <div class="point-card"><span class="point-bullet"></span><p>Place your hand over the <strong>mirror surface</strong> for <strong>3 seconds</strong> to launch the drone.</p></div>
          <div class="point-card"><span class="point-bullet"></span><p>The <strong>120-second timer</strong> begins only when you score your <strong>first point</strong>.</p></div>
          <div class="point-card"><span class="point-bullet"></span><p>Fly <strong>smoothly</strong>, stay inside the arena, and aim for <strong>accuracy</strong>.</p></div>
          <div class="point-card"><span class="point-bullet"></span><p>Score as many points as possible before time runs out.</p></div>
          <div class="point-card"><span class="point-bullet"></span><p><strong>Most important rule: Have fun!</strong></p></div>
        </div>
      </div>

      <div class="init-header">
        <div class="spinner" aria-hidden="true"></div>
        <h2>Initialising game components</h2>
        <p id="init-status" class="muted">Running connection checks...</p>
      </div>

      <div class="device-counter">
        <span id="devices-ready">0</span> / <span id="devices-total">4</span> devices initialized
      </div>

      <div id="init-steps" class="steps"></div>

      <div class="btn-row big mt-8">
        <button class="btn-cta" id="btn-start-game" disabled>Start Game</button>
        <button class="btn-ghost" onclick="backToChoose()">Back</button>
      </div>
    </div>
  </div>

  <!-- Page 5.5: Initialization Status (after failure) -->
  <div class="screen" id="page_init_status" style="display:none;">
    <div class="content-box status-wrap">
      <div class="status-content">
        <h2 class="status-title">Initialization Status</h2>
        <div class="device-counter large">
          <span id="status-ready">0</span> / <span id="status-total">0</span> devices ready
        </div>
        <div id="status-steps" class="steps"></div>
        <div class="btn-row big mt-8">
          <button class="btn-cta" onclick="retryFromStatus()">Retry Initialization</button>
          <button class="btn-ghost" onclick="backToChoose()">Back to Games</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Page 16: Leaderboard -->
  <div class="screen" id="page16">
    <div class="content-box">
      <h2>Leaderboard</h2>
      <div class="podium">
        <div class="pod second">...</div>
        <div class="pod first">...</div>
        <div class="pod third">...</div>
      </div>
      <table class="leaderboard-table">
        <tbody id="leaderboard-body"></tbody>
      </table>
    </div>
  </div>

  <script src="console.js"></script>
</body>
</html>

























/* ============================================================= */
/* FlyCamp Console – No Video, Direct Init, Fail-Safe Flow       */
/* ============================================================= */

let username = "";
let rfidTag = "";
let selectedGameId = null;
let selectedGameTitle = "";
let selectedGameDesc = "";
let scanInterval = null;
let scanningActive = true;

let controllerMode = 'joystick';
const WORD_A = 'Joystick Controller';
const WORD_B = 'Hand Gesture Controller';

const qs = (s, r = document) => r.querySelector(s);
const qsa = (s, r = document) => Array.from(r.querySelectorAll(s));

/* ------------------------------------------------------------------ */
/* Navigation & UI */
/* ------------------------------------------------------------------ */
function goToPage(id) {
  qsa('.screen').forEach(s => s.classList.remove('active'));
  const page = qs(`#${id}`);
  if (page) page.classList.add('active');
  document.body.style.backgroundColor = getComputedStyle(document.documentElement)
    .getPropertyValue('--bg').trim();

  if (id === 'page_choose_game') {
    const slider = qs('#game-card-container');
    if (slider && typeof slider.centerOnSecondCard === 'function') {
      slider.centerOnSecondCard();
    }
  }
}

function backToChoose() { goToPage('page_choose_game'); }

/* ------------------------------------------------------------------ */
/* Controller Toggle */
/* ------------------------------------------------------------------ */
function updateControllerLabels() {
  const toWord = controllerMode === 'joystick' ? WORD_A : WORD_B;
  const fromWord = controllerMode === 'joystick' ? WORD_B : WORD_A;

  const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, {
    acceptNode(node) {
      const txt = node.nodeValue;
      if (!txt) return NodeFilter.FILTER_SKIP;
      const lower = txt.toLowerCase();
      if (lower.includes(WORD_A.toLowerCase()) || lower.includes(WORD_B.toLowerCase())) {
        const p = node.parentElement;
        if (p && p.offsetParent !== null) return NodeFilter.FILTER_ACCEPT;
      }
      return NodeFilter.FILTER_SKIP;
    }
  });

  const nodes = [];
  while (walker.nextNode()) nodes.push(walker.currentNode);

  nodes.forEach(node => {
    let t = node.nodeValue;
    t = t.replace(new RegExp(WORD_A, 'ig'), WORD_A);
    t = t.replace(new RegExp(WORD_B, 'ig'), WORD_B);
    t = t.replace(new RegExp(fromWord, 'ig'), toWord);
    node.nodeValue = t;
  });
}

function registerControllerToggle() {
  const btn = qs('#logo-toggle');
  if (!btn) return;
  btn.addEventListener('click', () => {
    controllerMode = controllerMode === 'joystick' ? 'gesture' : 'joystick';
    updateControllerLabels();
  });
}

/* ------------------------------------------------------------------ */
/* RFID Scanning */
/* ------------------------------------------------------------------ */
function beginAutoScan() {
  const loader = qs('#loader1');
  if (loader) loader.textContent = 'Waiting for token...';

  scanInterval = setInterval(() => {
    if (!scanningActive) return;
    fetch('/scan_rfid')
      .then(r => r.json())
      .then(d => {
        if (d.success) {
          username = d.name;
          rfidTag = d.token_id;
          if (loader) loader.textContent = `Hi ${username}!`;
          setTimeout(() => {
            qs('#greeting').textContent = `Hi ${username}!`;
            qs('#user-info').textContent = `Token number: ${rfidTag}`;
            goToPage('page2');
          }, 600);
        }
      })
      .catch(err => console.error('RFID scan error:', err));
  }, 5000);
}

function confirmPlayer() {
  scanningActive = false;
  if (scanInterval) clearInterval(scanInterval);
  goToPage('page_choose_game');
}

/* ------------------------------------------------------------------ */
/* Game Selection Slider */
/* ------------------------------------------------------------------ */
function initializeCardSlider(selector) {
  const slider = qs(selector);
  if (!slider) return;
  const cards = qsa('.card', slider);

  function updateActiveCard() {
    const centre = slider.scrollLeft + slider.clientWidth / 2;
    let closest = null, minDist = Infinity;

    cards.forEach(card => {
      const cc = card.offsetLeft + card.offsetWidth / 2;
      const dist = Math.abs(cc - centre);
      if (dist < minDist) { minDist = dist; closest = card; }
    });

    cards.forEach(card => {
      card.classList.toggle('is-active', card === closest);
    });
  }

  let scrollTimeout;
  slider.addEventListener('scroll', () => {
    if (scrollTimeout) clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(updateActiveCard, 80);
  });

  cards.forEach(card => {
    card.addEventListener('click', () => {
      selectedGameId = parseInt(card.getAttribute('data-game-id'), 10);
      selectedGameTitle = card.getAttribute('data-title') || '';
      selectedGameDesc = card.getAttribute('data-desc') || '';

      qs('#chosen-game-title').textContent = `You chose: ${selectedGameTitle}`;
      qs('#chosen-game-desc').textContent = '';

      // Show rules from data-desc
      const rulesId = card.getAttribute('data-desc');
      qsa('#rules-container .rule-set').forEach(r => r.classList.add('hidden'));
      const target = qs(rulesId);
      if (target) target.classList.remove('hidden');

      goToPage('page_confirm');

      window.__initStarted = false;
      window.__initReady = false;
      window.__initSuccess = false;
    });
  });

  function centerOnSecondCard() {
    const second = cards[1];
    if (!second) return;
    const offset = second.offsetLeft - (slider.clientWidth / 2) + (second.offsetWidth / 2);
    slider.scrollLeft = offset;
    updateActiveCard();
  }

  slider.centerOnSecondCard = centerOnSecondCard;
  setTimeout(centerOnSecondCard, 50);
}

/* ------------------------------------------------------------------ */
/* Confirm → Direct to Init (No Video) */
/* ------------------------------------------------------------------ */
function registerConfirmButton() {
  const btn = qs('#confirm-game-btn');
  if (!btn) return;

  btn.addEventListener('click', () => {
    if (!window.__initStarted) {
      window.__initStarted = true;
      runConnectionCheckAndStart(0, true); // background
    }
    goToPage('page_initializing');
    waitForInitResults();
  });
}

function waitForInitResults() {
  if (!window.__initReady) {
    setTimeout(waitForInitResults, 150);
    return;
  }
  showStoredInitResultsSequentially();
}

/* ------------------------------------------------------------------ */
/* Connection Check & Init Logic */
/* ------------------------------------------------------------------ */
async function runConnectionCheckAndStart(delayStartMs = 0, skipStart = false) {
  try {
    clearSteps();
    qs('#init-status').textContent = 'Running connection checks...';

    const res = await fetch('/api/connection_check', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ game_number: selectedGameId || 1 })
    });
    const data = await res.json();

    const base = ['Joystick/Gesture', 'Nodes', 'Car', 'Drone'];
    const order = (selectedGameId === 2) ? base : base.filter(n => n !== 'Car');
    const results = [];

    for (const name of order) {
      const step = (data.steps || []).find(s => s.name === name);
      if (!step) continue;

      const label = name === 'Joystick/Gesture'
        ? (controllerMode === 'joystick' ? WORD_A : WORD_B)
        : step.name;

      results.push({ displayName: label, ok: !!step.ok, message: step.message || '' });

      if (!skipStart) {
        const row = addStepRow(label);
        await new Promise(r => setTimeout(r, 200));
        markRow(row, !!step.ok, step.message || '');
      }
    }

    window.__initStoredResults = { results, success: !!data.success };
    window.__initReady = true;
    window.__initSuccess = !!data.success;

    if (skipStart) return;

    if (!data.success) return;

    qs('#init-status').textContent = 'Connection OK. Preparing game...';
    if (delayStartMs > 0) await new Promise(r => setTimeout(r, delayStartMs));
    await startGame();
  } catch (e) {
    console.error('Init error:', e);
    qs('#init-status').textContent = 'Unexpected error.';
  }
}

async function startGame() {
  try {
    await fetch('/write_rfid_token', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ token_id: rfidTag })
    });

    const res = await fetch('/api/start_game', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ game_number: selectedGameId || 1, level_number: 1 })
    });
    const data = await res.json();

    if (!data.success) {
      qs('#init-status').textContent = data.error || 'Failed to launch.';
      return;
    }

    qs('#init-status').textContent = 'Game started. Good luck!';
    checkGameDone();
  } catch (err) {
    console.error('Start error:', err);
    qs('#init-status').textContent = 'Unexpected error.';
  }
}

/* ------------------------------------------------------------------ */
/* Show Results + Failure Flow */
/* ------------------------------------------------------------------ */
function showStoredInitResultsSequentially() {
  const stored = window.__initStoredResults;
  if (!stored || !stored.results) return;

  clearSteps();
  qs('#init-status').textContent = 'Running connection checks...';

  let idx = 0;
  function displayNext() {
    if (idx < stored.results.length) {
      const step = stored.results[idx++];
      const row = addStepRow(step.displayName);
      setTimeout(() => {
        markRow(row, step.ok, step.message);
        setTimeout(displayNext, 200);
      }, 200);
    } else {
      if (!stored.success) {
        triggerFailureFlow();
      } else {
        qs('#init-status').textContent = 'Connection OK. Preparing game...';
        setTimeout(startGame, 3000);
      }
    }
  }
  displayNext();
}

function triggerFailureFlow() {
  const overlay = qs('#black-overlay');
  overlay.classList.add('active');
  setTimeout(() => {
    overlay.classList.remove('active');
    goToPage('page_init_status');
    renderStatusPage();
  }, 1000);
}

function renderStatusPage() {
  const stored = window.__initStoredResults;
  if (!stored) return;

  const readyEl = qs('#status-ready');
  const totalEl = qs('#status-total');
  const container = qs('#status-steps');

  totalEl.textContent = stored.results.length;
  readyEl.textContent = stored.results.filter(r => r.ok).length;
  container.innerHTML = '';

  stored.results.forEach((step, i) => {
    const row = document.createElement('div');
    row.className = `step ${step.ok ? 'ok' : 'fail'}`;
    row.innerHTML = `<div class="checkbox"></div><span>${step.displayName} — ${step.ok ? 'Ready' : 'Failed'}</span>`;
    row.style.animationDelay = `${0.1 + i * 0.1}s`;
    container.appendChild(row);
  });
}

/* ------------------------------------------------------------------ */
/* Step Helpers & Retry */
/* ------------------------------------------------------------------ */
function clearSteps() { qs('#init-steps')?.replaceChildren(); }

function addStepRow(name) {
  const row = document.createElement('div');
  row.className = 'step';
  row.innerHTML = `<div>${name}</div><div>...</div>`;
  qs('#init-steps').appendChild(row);
  requestAnimationFrame(() => row.classList.add('show'));
  return row;
}

function markRow(row, ok, msg) {
  row.classList.toggle('ok', ok);
  row.classList.toggle('fail', !ok);
  row.lastChild.textContent = ok ? 'OK' : 'Failed';
  if (msg) {
    const m = document.createElement('div');
    m.style.fontSize = '12px'; m.style.opacity = '0.85'; m.style.margin = '4px 0 0 6px';
    m.textContent = msg;
    qs('#init-steps').appendChild(m);
  }
}

function retryFromStatus() {
  goToPage('page_initializing');
  setTimeout(() => {
    window.__initStarted = false;
    window.__initReady = false;
    window.__initSuccess = false;
    runConnectionCheckAndStart(3000, false);
  }, 600);
}

/* ------------------------------------------------------------------ */
/* Leaderboard */
/* ------------------------------------------------------------------ */
function checkGameDone() {
  const intv = setInterval(() => {
    fetch('/game_done')
      .then(r => r.json())
      .then(d => {
        if (d.done) {
          clearInterval(intv);
          showLeaderboard();
        }
      })
      .catch(() => clearInterval(intv));
  }, 1500);
}

function showLeaderboard() {
  goToPage('page16');
  const tbody = qs('#leaderboard-body');
  if (!tbody) return;

  ['first', 'second', 'third'].forEach(cls => {
    const pod = qs('.pod.' + cls);
    if (pod) {
      const nameEl = pod.querySelector('.pod-name');
      const scoreEl = pod.querySelector('.pod-score');
      if (nameEl) nameEl.textContent = '';
      if (scoreEl) scoreEl.textContent = '';
    }
  });

  tbody.innerHTML = '<tr><td colspan="3">Loading...</td></tr>';

  fetch('/get_leaderboard')
    .then(r => r.json())
    .then(data => {
      const players = (data && data.leaderboard) ? data.leaderboard : [];
      const podium = [players[0], players[1], players[2]];

      ['first', 'second', 'third'].forEach((cls, idx) => {
        const pod = qs('.pod.' + cls);
        const player = podium[idx];
        if (pod) {
          const nameEl = pod.querySelector('.pod-name');
          const scoreEl = pod.querySelector('.pod-score');
          if (nameEl) nameEl.textContent = player ? player.name : '';
          if (scoreEl) scoreEl.textContent = player ? player.score : '';
        }
      });

      if (players.length <= 3) {
        tbody.innerHTML = '<tr><td colspan="3">All players are on the podium!</td></tr>';
        return;
      }

      tbody.innerHTML = players.slice(3).map((p, i) =>
        `<tr><td>${i + 4}</td><td>${p.name}</td><td>${p.score}</td></tr>`
      ).join('');
    })
    .catch(() => {
      tbody.innerHTML = '<tr><td colspan="3">Error loading leaderboard.</td></tr>';
    });
}

/* ------------------------------------------------------------------ */
/* Boot */
/* ------------------------------------------------------------------ */
window.onload = function () {
  registerControllerToggle();
  beginAutoScan();
  initializeCardSlider('#game-card-container');
  registerConfirmButton();
};

window.goToPage = goToPage;
window.confirmPlayer = confirmPlayer;
window.backToChoose = backToChoose;
window.retryFromStatus = retryFromStatus;
window.backToHome = function () {
  goToPage('page1');
  if (scanInterval) clearInterval(scanInterval);
  scanningActive = true;
  beginAutoScan();
};



























/* ============================================================= */
/* FlyCamp Console – Clean, No Video, Responsive UI             */
/* ============================================================= */

:root {
  --bg: #0a001f;
  --accent: #bf00ff;
  --text: #e6e6ff;
  --card-bg: rgba(191, 0, 255, 0.15);
  --card-border: rgba(191, 0, 255, 0.4);
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Segoe UI', sans-serif;
  overflow: hidden;
  height: 100vh;
}

.screen {
  display: none;
  height: 100vh;
  padding: 20px;
  overflow-y: auto;
}
.screen.active { display: flex; flex-direction: column; justify-content: center; align-items: center; }

.content-box {
  width: 100%;
  max-width: 900px;
  text-align: center;
}

/* Buttons */
.btn-row { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; margin-top: 24px; }
.btn-cta, .btn-ghost {
  padding: 14px 28px;
  font-size: clamp(15px, 2vw, 18px);
  font-weight: 600;
  border-radius: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 160px;
}
.btn-cta {
  background: linear-gradient(135deg, #ff5252, #d32f2f);
  color: white;
  border: none;
  box-shadow: 0 0 20px rgba(255, 82, 82, 0.5);
}
.btn-cta:hover { transform: translateY(-3px); box-shadow: 0 0 30px rgba(255, 82, 82, 0.7); }
.btn-ghost {
  background: transparent;
  color: #ffcccc;
  border: 2px solid #ff6b6b;
}
.btn-ghost:hover { background: rgba(255, 82, 82, 0.2); }

/* Cards */
.card-slider {
  display: flex;
  overflow-x: auto;
  gap: 20px;
  padding: 20px 0;
  scroll-snap-type: x mandatory;
}
.card {
  flex: 0 0 80%;
  max-width: 420px;
  background: var(--card-bg);
  border: 1.5px solid var(--card-border);
  border-radius: 20px;
  padding: 20px;
  scroll-snap-align: center;
  transition: transform 0.3s ease;
  backdrop-filter: blur(10px);
}
.card.is-active { transform: scale(1.05); box-shadow: 0 0 30px rgba(191,0,255,.6); }
.card-title { font-size: clamp(22px, 4vw, 28px); margin-bottom: 16px; color: #ff66ff; }
.card-image { width: 100%; border-radius: 16px; margin-top: 16px; }

/* Rules */
.game-rules, .generic-rules { margin: 20px 0; }
.rules-title { font-size: clamp(20px, 3vw, 28px); margin-bottom: 12px; color: #ff66ff; }
.point-cards { display: flex; flex-direction: column; gap: 12px; }
.point-card {
  background: var(--card-bg);
  border: 1.5px solid var(--card-border);
  border-radius: 16px;
  padding: 14px 18px;
  text-align: left;
  font-size: clamp(14px, 1.8vw, 17px);
  backdrop-filter: blur(8px);
}
.point-bullet {
  display: inline-block;
  width: 8px; height: 8px;
  background: var(--accent);
  border-radius: 50%;
  margin-right: 10px;
}

/* Init Page */
.init-header { margin: 20px 0; }
.spinner {
  width: 60px; height: 60px;
  border: 4px solid rgba(191,0,255,.2);
  border-top: 4px solid var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 16px;
}
.device-counter {
  font-size: clamp(20px, 2.5vw, 28px);
  font-weight: 700;
  color: var(--accent);
  margin: 16px 0;
  text-shadow: 0 0 12px rgba(191,0,255,.7);
}
#devices-ready {
  background: linear-gradient(135deg, #00ff88, #00b86e);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-size: 1.4em;
}
.steps { display: flex; flex-direction: column; gap: 12px; margin: 0 auto 20px; max-width: 700px; }
.step {
  display: flex; align-items: center; gap: 14px;
  padding: 14px 18px;
  background: var(--card-bg);
  border: 1.5px solid var(--card-border);
  border-radius: 16px;
  font-size: clamp(15px, 1.9vw, 19px);
  font-weight: 500;
  opacity: 0;
  transform: translateX(-20px);
  animation: slideIn 0.5s forwards;
  backdrop-filter: blur(10px);
}
.step.show { opacity: 1; transform: translateX(0); }
.step .checkbox {
  width: 28px; height: 28px;
  border: 2.5px solid rgba(191,0,255,.6);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
}
.step .checkbox::before {
  content: 'OK'; font-size: 16px; font-weight: 900; color: #00ff88;
  opacity: 0; transform: scale(0); transition: all 0.3s ease;
}
.step.ok .checkbox { background: rgba(0,255,136,.3); border-color: #00ff88; box-shadow: 0 0 15px rgba(0,255,136,.6); }
.step.ok .checkbox::before { opacity: 1; transform: scale(1); animation: checkPop 0.35s ease; }
.step.fail .checkbox::before { content: 'Failed'; color: #ff5252; opacity: 1; transform: scale(1); }
.step.fail { background: rgba(255,82,82,.2); border-color: #ff5252; color: #ffaaaa; }

/* Black Overlay */
.black-overlay {
  position: fixed; inset: 0; background: #000; z-index: 7000;
  opacity: 0; pointer-events: none; transition: opacity .6s ease;
}
.black-overlay.active { opacity: 1; pointer-events: all; }

/* Status Page */
#page_init_status { background: radial-gradient(circle at center, #1a0033, #000); }
.status-wrap { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
.status-content { width: 100%; max-width: 720px; animation: fadeInUp 0.7s ease 0.6s both; }
.status-title { font-size: clamp(28px, 5vw, 42px); font-weight: 800; color: #ff66ff; text-shadow: 0 0 20px rgba(255,102,255,.8); margin-bottom: 24px; }
.device-counter.large { font-size: clamp(26px, 4.5vw, 38px); }
#status-steps .step { margin: 8px 0; animation: slideIn 0.5s ease forwards; }

/* Animations */
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes slideIn { to { opacity: 1; transform: translateX(0); } }
@keyframes checkPop { 0% { transform: scale(0); } 70% { transform: scale(1.3); } 100% { transform: scale(1); } }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

/* Mobile */
@media (max-width: 768px) {
  .btn-row { flex-direction: column; }
  .btn-cta, .btn-ghost { width: 100%; max-width: 300px; }
  .card { flex: 0 0 90%; }
}
